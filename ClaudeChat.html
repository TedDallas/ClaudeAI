<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Claude AI Chat</title>
    
    <!-- Add Marked.js for Markdown parsing -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <!-- Add Prism.js for syntax highlighting -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    
    <!-- Add required dependencies first -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-markup.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-clike.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-markup-templating.min.js"></script>
    
    <!-- Add common language support -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-typescript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-jsx.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-tsx.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-java.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-csharp.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-cpp.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-c.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-php.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-ruby.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-go.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-rust.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-sql.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-yaml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-json.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-markdown.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-scss.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-pascal.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(to right, #2c3e5f 0%, #1e5a3d 100%);
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            transition: background 0.3s ease;
        }

        /* Mobile mode adjustments */
        body.mobile-mode {
            padding: 0;
            align-items: stretch;
        }

        /* Dark mode styles */
		body.dark-mode {
			background: linear-gradient(to right, #0a1628 0%, #0d1f1a 100%);
		}

        .container {
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            width: 100%;
            min-width: 720px;
            max-width: 1200px;
            height: 90vh;
            display: flex;
            flex-direction: column;
            position: relative;
            transition: background 0.3s ease, box-shadow 0.3s ease;
        }

        /* Mobile mode container adjustments */
        body.mobile-mode .container {
            min-width: 100%;
            max-width: 100%;
            height: 100vh;
            border-radius: 0;
        }

        body.dark-mode .container {
            background: #1e1e1e;
            box-shadow: 0 10px 40px rgba(0,0,0,0.6);
        }

        .header {
            padding: 20px;
            border-bottom: 1px solid #e0e0e0;
            background: #f8f9fa;
            border-radius: 10px 10px 0 0;
            transition: background 0.3s ease, border-color 0.3s ease;
        }

        /* Mobile mode header adjustments */
        body.mobile-mode .header {
            padding: 12px;
            border-radius: 0;
        }

        body.dark-mode .header {
            background: #252525;
            border-bottom-color: #404040;
        }

        .header h1 {
            font-size: 24px;
            color: #333;
            margin-bottom: 10px;
            transition: color 0.3s ease;
        }

        /* Mobile mode h1 adjustments */
        body.mobile-mode .header h1 {
            font-size: 18px;
            margin-bottom: 8px;
        }

        body.dark-mode .header h1 {
            color: #e0e0e0;
        }

        .model-selector {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        /* Mobile mode model selector adjustments */
        body.mobile-mode .model-selector {
            gap: 6px;
            font-size: 13px;
        }

        .model-selector label {
            font-weight: 500;
            color: #555;
            transition: color 0.3s ease;
        }

        body.dark-mode .model-selector label {
            color: #b0b0b0;
        }

        .model-selector select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            cursor: pointer;
            background: white;
            color: #333;
            transition: background 0.3s ease, border-color 0.3s ease, color 0.3s ease;
        }

        /* Mobile mode select adjustments */
        body.mobile-mode .model-selector select {
            padding: 10px 8px;
            font-size: 14px;
            min-height: 44px;
        }

        body.dark-mode .model-selector select {
            background: #2d2d2d;
            border-color: #404040;
            color: #e0e0e0;
        }

        /* Thinking mode toggle styles */
        .thinking-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 0 10px;
            background: #f0f0f0;
            border-radius: 5px;
            transition: opacity 0.3s, background 0.3s ease;
        }

        /* Mobile mode thinking toggle adjustments */
        body.mobile-mode .thinking-toggle {
            padding: 8px;
            min-height: 44px;
        }

        body.dark-mode .thinking-toggle {
            background: #2d2d2d;
        }

        .thinking-toggle.disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .thinking-toggle label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            user-select: none;
            color: #333;
            transition: color 0.3s ease;
        }

        /* Mobile mode toggle label adjustments */
        body.mobile-mode .thinking-toggle label {
            font-size: 13px;
        }

        body.dark-mode .thinking-toggle label {
            color: #e0e0e0;
        }

        .thinking-toggle.disabled label {
            cursor: not-allowed;
        }

        .toggle-switch {
            position: relative;
            width: 44px;
            height: 24px;
            background: #ccc;
            border-radius: 12px;
            transition: background-color 0.3s;
            cursor: pointer;
        }

        body.dark-mode .toggle-switch {
            background: #555;
        }

        .thinking-toggle.disabled .toggle-switch {
            cursor: not-allowed;
        }

        .toggle-switch.active {
            background: #667eea;
        }

        body.dark-mode .toggle-switch.active {
            background: #7c8ef0;
        }

        .toggle-slider {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .toggle-switch.active .toggle-slider {
            transform: translateX(20px);
        }

        /* Thinking toggles container - now below model selector */
        .thinking-toggles-container {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        /* Mobile mode toggles container adjustments */
        body.mobile-mode .thinking-toggles-container {
            gap: 6px;
            margin-top: 8px;
        }

        .thinking-indicator {
            display: none;
            padding: 8px 12px;
            background: #e3f2fd;
            border: 1px solid #90caf9;
            border-radius: 5px;
            color: #1976d2;
            font-size: 12px;
            align-items: center;
            gap: 8px;
            transition: background 0.3s ease, border-color 0.3s ease, color 0.3s ease;
        }

        /* Mobile mode thinking indicator adjustments */
        body.mobile-mode .thinking-indicator {
            padding: 6px 10px;
            font-size: 11px;
            width: 100%;
        }

        body.dark-mode .thinking-indicator {
            background: #1a3a52;
            border-color: #2b5a7f;
            color: #6eb4f0;
        }

        .thinking-indicator.active {
            display: flex;
        }

        .thinking-indicator .thinking-dot {
            width: 6px;
            height: 6px;
            background: #1976d2;
            border-radius: 50%;
            animation: pulse 1.5s infinite;
        }

        body.dark-mode .thinking-indicator .thinking-dot {
            background: #6eb4f0;
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.3;
            }
        }

        /* Thinking content styles */
        .thinking-content {
            background: #f5f5f5;
            border-left: 3px solid #90caf9;
            padding: 12px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            color: #666;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
            transition: background 0.3s ease, border-color 0.3s ease, color 0.3s ease;
        }

        /* Mobile mode thinking content adjustments */
        body.mobile-mode .thinking-content {
            font-size: 12px;
            padding: 10px;
            max-height: 150px;
        }

        body.dark-mode .thinking-content {
            background: #2a2a2a;
            border-left-color: #2b5a7f;
            color: #b0b0b0;
        }

        .thinking-content summary {
            cursor: pointer;
            user-select: none;
            font-weight: 600;
            color: #1976d2;
            margin-bottom: 8px;
            transition: color 0.3s ease;
        }

        body.dark-mode .thinking-content summary {
            color: #6eb4f0;
        }

        .api-key-section {
            margin-top: 10px;
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        /* Mobile mode API key section adjustments */
        body.mobile-mode .api-key-section {
            gap: 8px;
            margin-top: 8px;
        }

        .api-key-section.hidden {
            display: none;
        }

        .api-key-section input {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            background: white;
            color: #333;
            transition: background 0.3s ease, border-color 0.3s ease, color 0.3s ease;
        }

        /* Mobile mode input adjustments */
        body.mobile-mode .api-key-section input {
            padding: 12px;
            font-size: 16px;
            min-height: 44px;
        }

        body.dark-mode .api-key-section input {
            background: #2d2d2d;
            border-color: #404040;
            color: #e0e0e0;
        }

        .api-key-section input[type="password"] {
            width: 200px;
        }

        /* Mobile mode password input adjustments */
        body.mobile-mode .api-key-section input[type="password"] {
            width: 100%;
            flex: 1 1 100%;
        }

        .api-key-section button {
            padding: 8px 16px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s ease;
        }

        /* Mobile mode button adjustments */
        body.mobile-mode .api-key-section button {
            padding: 12px 16px;
            font-size: 15px;
            min-height: 44px;
            flex: 1 1 calc(50% - 4px);
        }

        .api-key-section button:hover {
            background: #5568d3;
        }

        .api-key-section .test-connection-button {
            background: #28a745;
            color: white;
        }

        .api-key-section .test-connection-button:hover {
            background: #218838;
        }

        /* Temperature and Thinking Tokens field styles */
        .temperature-field, .thinking-tokens-field {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* Mobile mode field adjustments */
        body.mobile-mode .temperature-field,
        body.mobile-mode .thinking-tokens-field {
            flex: 1 1 100%;
        }

        .temperature-field label, .thinking-tokens-field label {
            font-size: 14px;
            color: #555;
            font-weight: 500;
            transition: color 0.3s ease;
        }

        /* Mobile mode label adjustments */
        body.mobile-mode .temperature-field label,
        body.mobile-mode .thinking-tokens-field label {
            font-size: 13px;
        }

        body.dark-mode .temperature-field label,
        body.dark-mode .thinking-tokens-field label {
            color: #b0b0b0;
        }

		.temperature-field input {
			width: 70px;
			padding: 8px 12px;
			border: 1px solid #ddd;
			border-radius: 5px;
			font-size: 14px;
			text-align: center;
            background: white;
            color: #333;
            transition: background 0.3s ease, border-color 0.3s ease, color 0.3s ease;
		}

        /* Mobile mode temperature input adjustments */
        body.mobile-mode .temperature-field input {
            flex: 1;
            min-height: 44px;
            font-size: 16px;
        }

        body.dark-mode .temperature-field input {
            background: #2d2d2d;
            border-color: #404040;
            color: #e0e0e0;
        }

		.thinking-tokens-field input {
			width: 105px;
			padding: 8px 12px;
			border: 1px solid #ddd;
			border-radius: 5px;
			font-size: 14px;
			text-align: center;
            background: white;
            color: #333;
            transition: background 0.3s ease, border-color 0.3s ease, color 0.3s ease;
		}

        /* Mobile mode thinking tokens input adjustments */
        body.mobile-mode .thinking-tokens-field input {
            flex: 1;
            min-height: 44px;
            font-size: 16px;
        }

        body.dark-mode .thinking-tokens-field input {
            background: #2d2d2d;
            border-color: #404040;
            color: #e0e0e0;
        }
		
        .temperature-field input:disabled, .thinking-tokens-field input:disabled {
            background-color: #f5f5f5;
            color: #999;
            cursor: not-allowed;
        }

        body.dark-mode .temperature-field input:disabled,
        body.dark-mode .thinking-tokens-field input:disabled {
            background-color: #1a1a1a;
            color: #666;
        }

        /* Thinking tokens field specific styling */
        .thinking-tokens-field {
            transition: opacity 0.3s;
        }

        .thinking-tokens-field.disabled {
            opacity: 0.4;
        }

        .thinking-tokens-field.disabled input {
            background-color: #f5f5f5;
            color: #999;
            cursor: not-allowed;
        }

        body.dark-mode .thinking-tokens-field.disabled input {
            background-color: #1a1a1a;
            color: #666;
        }

        .thinking-tokens-field.disabled label {
            color: #999;
        }

        body.dark-mode .thinking-tokens-field.disabled label {
            color: #666;
        }

        /* Right-side buttons positioning */
        .right-buttons {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 10;
        }

        /* Mobile mode right buttons adjustments */
        body.mobile-mode .right-buttons {
            position: static;
            flex-direction: row;
            margin-top: 8px;
            justify-content: space-between;
        }

        .right-buttons button {
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            white-space: nowrap;
            transition: background 0.3s ease;
        }

        /* Mobile mode right button adjustments */
        body.mobile-mode .right-buttons button {
            padding: 12px 16px;
            font-size: 14px;
            min-height: 44px;
            flex: 1;
        }

        .clear-button {
            background: #dc3545;
            color: white;
        }

        .clear-button:hover {
            background: #c82333;
        }

        .save-button {
            background: #007bff;
            color: white;
        }

        .save-button:hover {
            background: #0056b3;
        }

        .load-button {
            background: #6c757d;
            color: white;
        }

        .load-button:hover {
            background: #545b62;
        }

        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-left: 10px;
        }

        .status-indicator.connected {
            background: #4caf50;
        }

        .status-indicator.disconnected {
            background: #f44336;
        }

        .chat-container {
            flex: 1;
            overflow-y: auto;
            overflow-x: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            position: relative;
            background: white;
            transition: background 0.3s ease;
        }

        /* Mobile mode chat container adjustments */
        body.mobile-mode .chat-container {
            padding: 12px;
            gap: 12px;
        }

        body.dark-mode .chat-container {
            background: #1e1e1e;
        }

        .message {
            display: flex;
            gap: 10px;
            max-width: 80%;
            animation: fadeIn 0.3s ease-in;
            position: relative;
        }

        /* Mobile mode message adjustments */
        body.mobile-mode .message {
            max-width: 95%;
            gap: 8px;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            align-self: flex-end;
            flex-direction: row-reverse;
        }

        .message.assistant {
            align-self: flex-start;
            max-width: calc(100% - 46px);
        }

        /* Mobile mode assistant message adjustments */
        body.mobile-mode .message.assistant {
            max-width: calc(100% - 40px);
        }

        .message-content {
            padding: 12px 16px;
            border-radius: 10px;
            line-height: 1.6;
            word-wrap: break-word;
            overflow-wrap: break-word;
            width: fit-content;
            max-width: 100%;
            position: relative;
            transition: background 0.3s ease, color 0.3s ease;
        }

        /* Mobile mode message content adjustments */
        body.mobile-mode .message-content {
            padding: 10px 12px;
            font-size: 15px;
            line-height: 1.5;
        }

        .message.user .message-content {
            background: #667eea;
            color: white;
            white-space: pre-wrap;
        }

        body.dark-mode .message.user .message-content {
            background: #5568d3;
        }

        .message.assistant .message-content {
            background: #f1f3f5;
            color: #333;
        }

        body.dark-mode .message.assistant .message-content {
            background: #2a2a2a;
            color: #e0e0e0;
        }

		/* Delete button styles */
		.delete-button {
			position: absolute;
			top: 8px;
			right: 8px;
			width: 24px;
			height: 24px;
			min-width: 24px;
			min-height: 24px;
			border-radius: 50%;
			background: #dc3545;
			color: white;
			border: none;
			cursor: pointer;
			font-size: 12px;
			font-weight: bold;
			display: inline-flex;
			align-items: center;
			justify-content: center;
			text-align: center;
			line-height: 1;
			opacity: 0;
			transition: opacity 0.2s, background 0.2s;
			z-index: 1000;
			padding: 0;
			overflow: hidden;
			pointer-events: auto;
		}

        /* Mobile mode delete button adjustments */
        body.mobile-mode .delete-button {
            width: 32px;
            height: 32px;
            min-width: 32px;
            min-height: 32px;
            font-size: 16px;
            top: 6px;
            right: 6px;
        }

        /* Always show delete button in mobile mode */
        body.mobile-mode .message.assistant .delete-button {
            opacity: 0.7;
        }

		.message.assistant:hover .delete-button {
			opacity: 0.7;
		}

		.delete-button:hover {
			opacity: 1 !important;
			background: #c82333;
		}

		/* Scroll to top button styles */
		.scroll-to-top-button {
			position: absolute;
			bottom: 8px;
			right: 8px;
			width: 28px;
			height: 28px;
			min-width: 28px;
			min-height: 28px;
			border-radius: 50%;
			background: #667eea;
			color: white;
			border: none;
			cursor: pointer;
			font-size: 14px;
			font-weight: bold;
			display: inline-flex;
			align-items: center;
			justify-content: center;
			text-align: center;
			line-height: 0;
			opacity: 0;
			transition: opacity 0.2s, background 0.2s;
			z-index: 1000;
			padding: 0;
			overflow: hidden;
			pointer-events: auto;
		}

        /* Mobile mode scroll to top button adjustments */
        body.mobile-mode .scroll-to-top-button {
            width: 36px;
            height: 36px;
            min-width: 36px;
            min-height: 36px;
            font-size: 16px;
            bottom: 6px;
            right: 6px;
        }

        /* Always show scroll button in mobile mode */
        body.mobile-mode .message .scroll-to-top-button {
            opacity: 0.7;
        }

		.message:hover .scroll-to-top-button {
			opacity: 0.7;
		}

		.scroll-to-top-button:hover {
			opacity: 1 !important;
			background: #5568d3;
		}

        /* Ensure code blocks and pre elements can expand properly */
        .message.assistant .message-content pre {
            margin: 12px 0;
            border-radius: 6px;
            overflow-x: auto;
            position: relative;
            max-width: 100%;
        }

        /* Mobile mode pre adjustments */
        body.mobile-mode .message.assistant .message-content pre {
            margin: 10px 0;
        }

        .message.assistant .message-content pre code {
            display: block;
            padding: 16px;
            background: #282c34;
            color: #abb2bf;
            font-size: 0.9em;
            line-height: 1.5;
            white-space: pre;
            word-wrap: normal;
            overflow-x: auto;
        }

        /* Mobile mode code adjustments */
        body.mobile-mode .message.assistant .message-content pre code {
            padding: 12px;
            font-size: 13px;
        }

        /* Markdown styling for assistant messages */
        .message.assistant .message-content h1,
        .message.assistant .message-content h2,
        .message.assistant .message-content h3,
        .message.assistant .message-content h4,
        .message.assistant .message-content h5,
        .message.assistant .message-content h6 {
            margin-top: 16px;
            margin-bottom: 8px;
            font-weight: 600;
            transition: color 0.3s ease;
        }

        /* Mobile mode heading adjustments */
        body.mobile-mode .message.assistant .message-content h1 { font-size: 1.4em; }
        body.mobile-mode .message.assistant .message-content h2 { font-size: 1.25em; }
        body.mobile-mode .message.assistant .message-content h3 { font-size: 1.1em; }

        .message.assistant .message-content h1 { font-size: 1.5em; }
        .message.assistant .message-content h2 { font-size: 1.3em; }
        .message.assistant .message-content h3 { font-size: 1.1em; }

        .message.assistant .message-content p {
            margin: 8px 0;
        }

        .message.assistant .message-content ul,
        .message.assistant .message-content ol {
            margin: 8px 0;
            padding-left: 24px;
        }

        /* Mobile mode list adjustments */
        body.mobile-mode .message.assistant .message-content ul,
        body.mobile-mode .message.assistant .message-content ol {
            padding-left: 20px;
        }

        .message.assistant .message-content li {
            margin: 4px 0;
        }

        .message.assistant .message-content blockquote {
            border-left: 3px solid #667eea;
            padding-left: 12px;
            margin: 8px 0;
            color: #666;
            font-style: italic;
            transition: border-color 0.3s ease, color 0.3s ease;
        }

        body.dark-mode .message.assistant .message-content blockquote {
            border-left-color: #7c8ef0;
            color: #999;
        }

        .message.assistant .message-content code {
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            padding: 2px 6px;
            background: #282c34;
            color: #abb2bf;
            border-radius: 3px;
        }

        /* Copy button and Run button for code blocks */
        .code-block-wrapper {
            position: relative;
            margin: 12px 0;
        }

        .copy-button, .run-button {
            position: absolute;
            top: 8px;
            padding: 4px 8px;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            z-index: 10;
            opacity: 0.8;
            transition: opacity 0.2s, background 0.3s ease;
        }

        /* Mobile mode code button adjustments */
        body.mobile-mode .copy-button,
        body.mobile-mode .run-button {
            padding: 8px 12px;
            font-size: 13px;
            min-height: 36px;
            opacity: 1;
        }

        .copy-button {
            right: 8px;
            background: #667eea;
        }

        .copy-button:hover {
            opacity: 1;
        }

        .copy-button.copied {
            background: #4caf50;
        }

        .run-button {
            right: 70px;
            background: #28a745;
        }

        /* Mobile mode run button position adjustment */
        body.mobile-mode .run-button {
            right: 90px;
        }

        .run-button:hover {
            opacity: 1;
            background: #218838;
        }

        .message.assistant .message-content table {
            border-collapse: collapse;
            margin: 12px 0;
            width: 100%;
            display: block;
            overflow-x: auto;
        }

        .message.assistant .message-content th,
        .message.assistant .message-content td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
            white-space: nowrap;
            transition: border-color 0.3s ease, background 0.3s ease;
        }

        /* Mobile mode table adjustments */
        body.mobile-mode .message.assistant .message-content th,
        body.mobile-mode .message.assistant .message-content td {
            padding: 6px;
            font-size: 13px;
        }

        body.dark-mode .message.assistant .message-content th,
        body.dark-mode .message.assistant .message-content td {
            border-color: #404040;
        }

        .message.assistant .message-content th {
            background: #f0f0f0;
            font-weight: 600;
        }

        body.dark-mode .message.assistant .message-content th {
            background: #333;
        }

        .message.assistant .message-content a {
            color: #667eea;
            text-decoration: none;
            transition: color 0.3s ease;
        }

        body.dark-mode .message.assistant .message-content a {
            color: #7c8ef0;
        }

        .message.assistant .message-content a:hover {
            text-decoration: underline;
        }

        .message.assistant .message-content hr {
            margin: 16px 0;
            border: none;
            border-top: 1px solid #e0e0e0;
            transition: border-color 0.3s ease;
        }

        body.dark-mode .message.assistant .message-content hr {
            border-top-color: #404040;
        }

        .message-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
            flex-shrink: 0;
            transition: background 0.3s ease, color 0.3s ease;
        }

        /* Mobile mode avatar adjustments */
        body.mobile-mode .message-avatar {
            width: 32px;
            height: 32px;
            font-size: 13px;
        }

        .message.user .message-avatar {
            background: #764ba2;
            color: white;
        }

        body.dark-mode .message.user .message-avatar {
            background: #5a3780;
        }

        .message.assistant .message-avatar {
            background: #e9ecef;
            color: #667eea;
        }

        body.dark-mode .message.assistant .message-avatar {
            background: #2d2d2d;
            color: #7c8ef0;
        }

        .input-container {
            padding: 20px;
            border-top: 1px solid #e0e0e0;
            background: #f8f9fa;
            border-radius: 0 0 10px 10px;
            transition: background 0.3s ease, border-color 0.3s ease;
        }

        /* Mobile mode input container adjustments */
        body.mobile-mode .input-container {
            padding: 12px;
            border-radius: 0;
        }

        body.dark-mode .input-container {
            background: #252525;
            border-top-color: #404040;
        }

        .input-wrapper {
            display: flex;
            gap: 10px;
            align-items: flex-end;
            position: relative;
        }

        /* Mobile mode input wrapper adjustments */
        body.mobile-mode .input-wrapper {
            gap: 8px;
        }

        #messageInput {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid #ddd;
            border-radius: 12px;
            font-size: 14px;
            outline: none;
            font-family: inherit;
            resize: vertical;
            min-height: 44px;
            max-height: 200px;
            overflow-y: auto;
            line-height: 1.5;
            background: white;
            color: #333;
            transition: background 0.3s ease, border-color 0.3s ease, color 0.3s ease;
        }

        /* Mobile mode message input adjustments */
        body.mobile-mode #messageInput {
            font-size: 16px;
            padding: 12px 14px;
            min-height: 48px;
            max-height: 150px;
        }

        body.dark-mode #messageInput {
            background: #2d2d2d;
            border-color: #404040;
            color: #e0e0e0;
        }

        #messageInput:focus {
            border-color: #667eea;
        }

        body.dark-mode #messageInput:focus {
            border-color: #7c8ef0;
        }

        /* Button container for Send/Cancel */
        .button-container {
            position: relative;
            width: 80px;
            height: 44px;
            align-self: flex-end;
        }

        /* Mobile mode button container adjustments */
        body.mobile-mode .button-container {
            width: 70px;
            height: 48px;
        }

		#sendButton, #cancelButton {
			position: absolute;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			padding: 0;
			color: white;
			border: none;
			border-radius: 25px;
			cursor: pointer;
			font-size: 14px;
			font-weight: 500;
			transition: background 0.3s, opacity 0.3s;
			display: flex;
			align-items: center;
			justify-content: center;
		}

        /* Mobile mode send/cancel button adjustments */
        body.mobile-mode #sendButton,
        body.mobile-mode #cancelButton {
            font-size: 15px;
        }

        #sendButton {
            background: #667eea;
            opacity: 1;
        }

        #sendButton:hover:not(:disabled) {
            background: #5568d3;
        }

        #sendButton:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        body.dark-mode #sendButton:disabled {
            background: #555;
        }

        #sendButton.hidden {
            opacity: 0;
            pointer-events: none;
        }

        #cancelButton {
            background: #dc3545;
            opacity: 0;
            pointer-events: none;
        }

        #cancelButton.visible {
            opacity: 1;
            pointer-events: auto;
        }

        #cancelButton:hover {
            background: #c82333;
        }

        .loading {
            display: flex;
            gap: 5px;
            padding: 12px 16px;
        }

        .loading-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #667eea;
            animation: bounce 1.4s infinite ease-in-out both;
        }

        body.dark-mode .loading-dot {
            background: #7c8ef0;
        }

        .loading-dot:nth-child(1) {
            animation-delay: -0.32s;
        }

        .loading-dot:nth-child(2) {
            animation-delay: -0.16s;
        }

        @keyframes bounce {
            0%, 80%, 100% {
                transform: scale(0);
            }
            40% {
                transform: scale(1);
            }
        }

        .error-message {
            background: #fee;
            color: #c33;
            padding: 12px 16px;
            border-radius: 10px;
            margin: 10px 0;
            border: 1px solid #fcc;
            transition: background 0.3s ease, border-color 0.3s ease, color 0.3s ease;
        }

        body.dark-mode .error-message {
            background: #3d1a1a;
            color: #ff6b6b;
            border-color: #5a2a2a;
        }

        .debug-info {
            font-size: 11px;
            color: #999;
            margin-top: 5px;
            font-family: monospace;
            transition: color 0.3s ease;
        }

        /* Mobile mode debug info adjustments */
        body.mobile-mode .debug-info {
            font-size: 10px;
            word-break: break-all;
        }

        body.dark-mode .debug-info {
            color: #777;
        }

        .max-tokens-info {
            font-size: 12px;
            color: #666;
            margin-left: 10px;
            font-style: italic;
            transition: color 0.3s ease;
        }

        /* Mobile mode max tokens info adjustments */
        body.mobile-mode .max-tokens-info {
            font-size: 11px;
            margin-left: 0;
            width: 100%;
            margin-top: 4px;
        }

        body.dark-mode .max-tokens-info {
            color: #999;
        }

        .session-tokens-info {
            font-size: 12px;
            color: #667eea;
            margin-left: 10px;
            font-weight: 600;
            padding: 4px 8px;
            background: #e8eaf6;
            border-radius: 4px;
            transition: background 0.3s ease, color 0.3s ease;
        }

        /* Mobile mode session tokens info adjustments */
        body.mobile-mode .session-tokens-info {
            font-size: 11px;
            margin-left: 0;
            width: 100%;
            margin-top: 4px;
        }

        body.dark-mode .session-tokens-info {
            background: #2a2d4a;
            color: #7c8ef0;
        }

        /* Hidden file input */
        #fileInput {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container" id="mainContainer">
        <!-- Right-side buttons -->
        <div class="right-buttons">
            <button class="clear-button" onclick="clearChat()">Clear Chat</button>
            <button class="save-button" onclick="saveChat()">Save Chat</button>
            <button class="load-button" onclick="loadChat()">Load Chat</button>
        </div>

        <div class="header">
            <h1>Chat with Claude AI <span class="status-indicator disconnected" id="statusIndicator"></span> </h1>
            <div class="api-key-section" id="apiKeySection">
                <input type="password" id="apiKeyInput" placeholder="Enter Anthropic API key">
                <button onclick="saveApiKey()">Save API Key</button>
                <button class="test-connection-button" onclick="testConnection()">Test Connection</button>
                <div class="temperature-field">
                    <label for="temperatureInput">Temperature:</label>
                    <input type="number" id="temperatureInput" min="0" max="2" step="0.1" value="0.7">
                </div>
                <div class="thinking-tokens-field" id="thinkingTokensField">
                    <label for="thinkingTokensInput">Thinking Tokens:</label>
                    <input type="number" id="thinkingTokensInput" min="1000" step="1000" value="4000">
                </div>
            </div>
            <div class="model-selector">
                <label for="modelSelect">Model:</label>
                <select id="modelSelect" onchange="updateMaxTokensInfo()">
                    <option value="claude-sonnet-4-5-20250929">Claude 4.5 Sonnet</option>
                    <option value="claude-opus-4-1-20250805">Claude 4.1 Opus</option> 
                    <option value="claude-haiku-4-5-20251001">Claude 4.5 Haiku</option>
                </select>
                <span class="max-tokens-info" id="maxTokensInfo">Max context/output tokens: (200,000, 64,000)</span>
                <span class="session-tokens-info" id="sessionTokensInfo">Session: 0 tokens</span>
				<span class="debug-info" id="debugInfo"></span>
            </div>
            
            <!-- Thinking toggles -->
            <div class="thinking-toggles-container">
                <div class="thinking-toggle">
                    <label>
                        <span>Setup</span>
                        <div class="toggle-switch" id="setupToggle" onclick="toggleSetup()">
                            <div class="toggle-slider"></div>
                        </div>
                    </label>
                </div>

                <div class="thinking-toggle">
                    <label>
                        <span>Thinking Mode</span>
                        <div class="toggle-switch" id="thinkingToggle" onclick="toggleThinking()">
                            <div class="toggle-slider"></div>
                        </div>
                    </label>
                </div>

                <div class="thinking-toggle">
                    <label>
                        <span>Dark Mode</span>
                        <div class="toggle-switch" id="darkModeToggle" onclick="toggleDarkMode()">
                            <div class="toggle-slider"></div>
						</div>
                    </label>
                </div>

                <div class="thinking-toggle">
                    <label>
                        <span>Mobile Mode</span>
                        <div class="toggle-switch" id="mobileModeToggle" onclick="toggleMobileMode()">
                            <div class="toggle-slider"></div>
						</div>
                    </label>
                </div>

                <div class="thinking-indicator" id="thinkingIndicator">
                    <div class="thinking-dot"></div>
                    <span id="thinkingIndicatorText">Thinking mode enabled (4000 thinking tokens).</span>
                </div>
            </div>
        </div>
        
        <div class="chat-container" id="chatContainer">
            <!-- Initial message will be set by JavaScript -->
        </div>
        
        <div class="input-container">
            <div class="input-wrapper">
                <textarea id="messageInput" placeholder="Type your message... (Press Enter to send, Shift+Enter for new line)" onkeydown="handleKeyDown(event)"></textarea>
                <div class="button-container">
                    <button id="sendButton" onclick="sendMessage()">Send</button>
                    <button id="cancelButton" onclick="cancelRequest()">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Hidden file input for loading chats -->
    <input type="file" id="fileInput" accept=".json" onchange="handleFileSelect(event)">

    <script>
        // API Configuration
        let API_KEY = ''; // Your API key will be stored here
        const STORAGE_KEY_PREFIX = 'claude_chat_app_';
		const API_URL = 'https://api.anthropic.com/v1/messages';
        const CORS_PROXY = ''; // You might need a CORS proxy for browser usage
        
        // Conversation history
        let conversationHistory = [];
        
        // Token tracking
        let sessionTokens = {
            input: 0,
            output: 0,
            total: 0
        };
        
        // Thinking mode state
        let thinkingMode = false;
        let setupVisible = false;
        let darkMode = false;
        let mobileMode = false;

        // Temperature state
        let currentTemperature = 0.7;
        let savedTemperature = 0.7;

        // Thinking tokens configuration
        let currentThinkingTokens = 4000;

        // Request cancellation
        let currentAbortController = null;
        let currentUserMessage = '';
        let currentLoadingId = null;

        // Model max tokens configuration (for output)
        const MODEL_MAX_TOKENS = {
            'claude-sonnet-4-5-20250929': 64000,  // Required output limit
            'claude-opus-4-1-20250805': 32000,    // Required output limit
            'claude-haiku-4-5-20251001': 64000    // Required output limit
        };

        // Model context window configuration (total input + output capacity)
        const MODEL_CONTEXT_WINDOWS = {
            'claude-sonnet-4-5-20250929': 200000,
            'claude-opus-4-1-20250805': 200000,
            'claude-haiku-4-5-20251001': 200000
        };

        // Minimum height threshold for showing scroll-to-top button (in pixels)
        const SCROLL_BUTTON_HEIGHT_THRESHOLD = 400;

        // Configure marked options
        marked.setOptions({
            highlight: function(code, lang) {
                const languageMap = {
                    'py': 'python',
                    'js': 'javascript',
                    'ts': 'typescript',
                    'sh': 'bash',
                    'yml': 'yaml',
                    'html': 'markup',
                    'xml': 'markup',
                    'pas': 'pascal',
                    'dpr': 'pascal',
                    'freepascal': 'pascal',
                    'objectpascal': 'pascal',
                    'lazarus': 'pascal'
                };
                
                const mappedLang = languageMap[lang] || lang;
                
                if (mappedLang && Prism.languages[mappedLang]) {
                    try {
                        return Prism.highlight(code, Prism.languages[mappedLang], mappedLang);
                    } catch (e) {
                        console.warn(`Error highlighting ${mappedLang}:`, e);
                        return code;
                    }
                }
                return code;
            },
            breaks: true,
            gfm: true,
            headerIds: false,
            mangle: false
        });

        function toggleMobileMode() {
            mobileMode = !mobileMode;
            localStorage.setItem('mobile_mode', mobileMode.toString());
            updateMobileModeToggle();
            applyMobileMode();
        }

        function updateMobileModeToggle() {
            const toggle = document.getElementById('mobileModeToggle');
            
            if (mobileMode) {
                toggle.classList.add('active');
            } else {
                toggle.classList.remove('active');
            }
        }

        function applyMobileMode() {
            if (mobileMode) {
                document.body.classList.add('mobile-mode');
            } else {
                document.body.classList.remove('mobile-mode');
            }
        }

        function toggleDarkMode() {
            darkMode = !darkMode;
            localStorage.setItem('dark_mode', darkMode.toString());
            updateDarkModeToggle();
            applyDarkMode();
        }

        function updateDarkModeToggle() {
            const toggle = document.getElementById('darkModeToggle');
            
            if (darkMode) {
                toggle.classList.add('active');
            } else {
                toggle.classList.remove('active');
            }
        }

        function applyDarkMode() {
            if (darkMode) {
                document.body.classList.add('dark-mode');
            } else {
                document.body.classList.remove('dark-mode');
            }
        }

        function setInitialGreeting() {
            const chatContainer = document.getElementById('chatContainer');
            let greetingMessage;
            
            if (API_KEY) {
                greetingMessage = "Hello! I'm Claude. How can I help you today?";
            } else {
                greetingMessage = "Hello! I'm Claude. Please enter your Anthropic API key above. \n\nNote: Make sure your API key starts with \"sk-ant-api\" and that CORS is handled properly. You might need to use a proxy server for production use, but for local testing, your browser might block direct API calls due to CORS policy.";
            }
            
            chatContainer.innerHTML = `
                <div class="message assistant">
                    <div class="message-avatar">C</div>
                    <div class="message-content">${escapeHtml(greetingMessage)}</div>
                </div>
            `;
        }

        function toggleSetup() {
            setupVisible = !setupVisible;
            const setupToggle = document.getElementById('setupToggle');
            const apiKeySection = document.getElementById('apiKeySection');
            
            if (setupVisible) {
                setupToggle.classList.add('active');
                apiKeySection.classList.remove('hidden');
            } else {
                setupToggle.classList.remove('active');
                apiKeySection.classList.add('hidden');
            }
            
            localStorage.setItem('setup_visible', setupVisible.toString());
        }

        function updateSetupToggle() {
            const setupToggle = document.getElementById('setupToggle');
            const apiKeySection = document.getElementById('apiKeySection');
            
            if (setupVisible) {
                setupToggle.classList.add('active');
                apiKeySection.classList.remove('hidden');
            } else {
                setupToggle.classList.remove('active');
                apiKeySection.classList.add('hidden');
            }
        }

        function updateTemperatureField() {
            const temperatureInput = document.getElementById('temperatureInput');
            
            if (thinkingMode) {
                savedTemperature = parseFloat(temperatureInput.value);
                temperatureInput.value = '1.0';
                temperatureInput.disabled = true;
                currentTemperature = 1.0;
            } else {
                temperatureInput.value = savedTemperature.toString();
                temperatureInput.disabled = false;
                currentTemperature = savedTemperature;
            }
        }

        function updateThinkingTokensField() {
            const thinkingTokensField = document.getElementById('thinkingTokensField');
            const thinkingTokensInput = document.getElementById('thinkingTokensInput');
            
            if (thinkingMode) {
                thinkingTokensField.classList.remove('disabled');
                thinkingTokensInput.disabled = false;
            } else {
                thinkingTokensField.classList.add('disabled');
                thinkingTokensInput.disabled = true;
            }
        }

        function onTemperatureChange() {
            const temperatureInput = document.getElementById('temperatureInput');
            const value = parseFloat(temperatureInput.value);
            
            if (value < 0) {
                temperatureInput.value = '0';
                currentTemperature = 0;
            } else if (value > 2) {
                temperatureInput.value = '2';
                currentTemperature = 2;
            } else {
                currentTemperature = value;
            }
            
            if (!thinkingMode) {
                savedTemperature = currentTemperature;
                localStorage.setItem('temperature', savedTemperature.toString());
            }
        }

        function onThinkingTokensChange() {
            const thinkingTokensInput = document.getElementById('thinkingTokensInput');
            const selectedModel = document.getElementById('modelSelect').value;
            const maxTokensForModel = MODEL_MAX_TOKENS[selectedModel];
            let value = parseInt(thinkingTokensInput.value);
            
            if (value < 1000) {
                value = 1000;
                thinkingTokensInput.value = value;
            } else if (value > maxTokensForModel) {
                value = maxTokensForModel;
                thinkingTokensInput.value = value;
            }
            
            currentThinkingTokens = value;
            updateThinkingIndicatorText();
            updateMaxTokensInfo();
            localStorage.setItem('thinking_tokens', currentThinkingTokens.toString());
        }

        function updateThinkingIndicatorText() {
            const thinkingIndicatorText = document.getElementById('thinkingIndicatorText');
            thinkingIndicatorText.textContent = `Thinking mode enabled (${currentThinkingTokens.toLocaleString()} thinking tokens).`;
        }

        function cancelRequest() {
            if (currentAbortController) {
                currentAbortController.abort();
                
                if (currentLoadingId) {
                    removeLoading(currentLoadingId);
                    currentLoadingId = null;
                }
                
                const chatContainer = document.getElementById('chatContainer');
                const messages = chatContainer.querySelectorAll('.message');
                if (messages.length > 0) {
                    const lastMessage = messages[messages.length - 1];
                    if (lastMessage.classList.contains('user')) {
                        lastMessage.remove();
                    }
                }
                
                if (conversationHistory.length > 0 && conversationHistory[conversationHistory.length - 1].role === 'user') {
                    conversationHistory.pop();
                }
                
                const messageInput = document.getElementById('messageInput');
                messageInput.value = currentUserMessage;
                autoResizeTextarea();
                
                currentAbortController = null;
                currentUserMessage = '';
                
                toggleCancelButton(false);
                
                const sendButton = document.getElementById('sendButton');
                sendButton.disabled = false;
                
                updateDebugInfo('Request cancelled');
                messageInput.focus();
            }
        }

        function toggleCancelButton(show) {
            const sendButton = document.getElementById('sendButton');
            const cancelButton = document.getElementById('cancelButton');
            
            if (show) {
                sendButton.classList.add('hidden');
                cancelButton.classList.add('visible');
            } else {
                sendButton.classList.remove('hidden');
                cancelButton.classList.remove('visible');
            }
        }

		function deleteLastExchange() {
			const chatContainer = document.getElementById('chatContainer');
			const messages = chatContainer.querySelectorAll('.message');
			
			if (messages.length < 2) {
				return;
			}
			
			let lastAssistantIndex = -1;
			for (let i = messages.length - 1; i >= 0; i--) {
				if (messages[i].classList.contains('assistant')) {
					lastAssistantIndex = i;
					break;
				}
			}
			
			if (lastAssistantIndex <= 0) {
				return;
			}
			
			let precedingUserIndex = -1;
			for (let i = lastAssistantIndex - 1; i >= 0; i--) {
				if (messages[i].classList.contains('user')) {
					precedingUserIndex = i;
					break;
				}
			}
			
			if (precedingUserIndex < 0) {
				return;
			}
			
			const userMessageContent = messages[precedingUserIndex].querySelector('.message-content').textContent.trim();
			
			messages[lastAssistantIndex].remove();
			messages[precedingUserIndex].remove();
			
			if (conversationHistory.length >= 2) {
				conversationHistory.pop();
				conversationHistory.pop();
			}
			
			const messageInput = document.getElementById('messageInput');
			messageInput.value = userMessageContent;
			messageInput.focus();
			
			autoResizeTextarea();
			
			updateDeleteButtons();
			
			updateDebugInfo('Last exchange deleted and message restored to input');
		}

		function updateDeleteButtons() {
			const chatContainer = document.getElementById('chatContainer');
			
			const existingButtons = chatContainer.querySelectorAll('.delete-button');
			existingButtons.forEach(btn => btn.remove());
			
			const assistantMessages = chatContainer.querySelectorAll('.message.assistant');
			
			if (assistantMessages.length > 1) {
				const lastAssistantMessage = assistantMessages[assistantMessages.length - 1];
				
				const deleteButton = document.createElement('button');
				deleteButton.className = 'delete-button';
				deleteButton.innerHTML = '×';
				deleteButton.title = 'Delete this response and restore your message';
				deleteButton.onclick = deleteLastExchange;
				
				const messageContent = lastAssistantMessage.querySelector('.message-content');
				if (messageContent) {
					messageContent.appendChild(deleteButton);
				}
			}
		}

		function scrollToTopOfMessage(messageElement) {
			const messageContent = messageElement.querySelector('.message-content');
			if (messageContent) {
				messageContent.scrollIntoView({ behavior: 'smooth', block: 'start' });
			}
		}

		function addScrollToTopButtons() {
			const chatContainer = document.getElementById('chatContainer');
			
			const existingScrollButtons = chatContainer.querySelectorAll('.scroll-to-top-button');
			existingScrollButtons.forEach(btn => btn.remove());
			
			const allMessages = chatContainer.querySelectorAll('.message');
			
			allMessages.forEach(messageDiv => {
				const messageContent = messageDiv.querySelector('.message-content');
				if (messageContent && messageContent.offsetHeight > SCROLL_BUTTON_HEIGHT_THRESHOLD) {
					const scrollButton = document.createElement('button');
					scrollButton.className = 'scroll-to-top-button';
					scrollButton.innerHTML = '↑';
					scrollButton.title = 'Scroll to top of this message';
					scrollButton.onclick = function(e) {
						e.stopPropagation();
						scrollToTopOfMessage(messageDiv);
					};
					
					messageContent.appendChild(scrollButton);
				}
			});
		}

        function saveChat() {
            if (conversationHistory.length === 0) {
                alert('No chat history to save!');
                return;
            }

            const chatData = {
                version: '1.0',
                timestamp: new Date().toISOString(),
                model: document.getElementById('modelSelect').value,
                thinkingMode: thinkingMode,
                temperature: currentTemperature,
                savedTemperature: savedTemperature,
                thinkingTokens: currentThinkingTokens,
                sessionTokens: sessionTokens,
                conversationHistory: conversationHistory,
                chatHtml: document.getElementById('chatContainer').innerHTML
            };

            const dataStr = JSON.stringify(chatData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            
            const timestamp = new Date().toISOString().replace(/[:.]/g, '-').slice(0, -5);
            link.download = `claude-chat-${timestamp}.json`;
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            updateDebugInfo('Chat saved successfully');
        }

        function loadChat() {
            document.getElementById('fileInput').click();
        }

        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const chatData = JSON.parse(e.target.result);
                    
                    if (!chatData.conversationHistory || !Array.isArray(chatData.conversationHistory)) {
                        throw new Error('Invalid chat file format');
                    }

                    conversationHistory = chatData.conversationHistory;
                    
                    if (chatData.sessionTokens) {
                        sessionTokens = chatData.sessionTokens;
                        updateSessionTokensDisplay();
                    }
                    
                    if (chatData.model) {
                        document.getElementById('modelSelect').value = chatData.model;
                        updateMaxTokensInfo();
                    }
                    
                    if (chatData.thinkingMode !== undefined) {
                        thinkingMode = chatData.thinkingMode;
                        updateThinkingToggle();
                    }

                    if (chatData.temperature !== undefined) {
                        currentTemperature = chatData.temperature;
                    }
                    if (chatData.savedTemperature !== undefined) {
                        savedTemperature = chatData.savedTemperature;
                    }

                    if (chatData.thinkingTokens !== undefined) {
                        currentThinkingTokens = chatData.thinkingTokens;
                        document.getElementById('thinkingTokensInput').value = currentThinkingTokens;
                        updateThinkingIndicatorText();
                    }

                    updateTemperatureField();
                    updateThinkingTokensField();

                    rebuildChatFromHistory();
                    
                    updateDebugInfo('Chat loaded successfully');
                    event.target.value = '';
                    
                } catch (error) {
                    alert('Error loading chat file: ' + error.message);
                    console.error('Error loading chat:', error);
                    event.target.value = '';
                }
            };
            
            reader.onerror = function() {
                alert('Error reading file');
                event.target.value = '';
            };
            
            reader.readAsText(file);
        }

		async function rebuildChatFromHistory() {
			const chatContainer = document.getElementById('chatContainer');
			chatContainer.innerHTML = '';
			
			for (const msg of conversationHistory) {
				const processedMessage = processThinkingContent(msg.content);
				await addMessageToChat(msg.role, processedMessage.displayContent, processedMessage.thinkingContent, false);
			}
			
			await new Promise(resolve => setTimeout(resolve, 300));
			updateDeleteButtons();
			addScrollToTopButtons();
			chatContainer.scrollTop = chatContainer.scrollHeight;
		}

        function autoResizeTextarea() {
            const textarea = document.getElementById('messageInput');
            textarea.style.height = 'auto';
            const maxHeight = mobileMode ? 150 : 200;
            const minHeight = mobileMode ? 48 : 44;
            textarea.style.height = Math.max(Math.min(textarea.scrollHeight, maxHeight), minHeight) + 'px';
        }

        document.addEventListener('DOMContentLoaded', function() {
            const messageInput = document.getElementById('messageInput');
            messageInput.addEventListener('input', autoResizeTextarea);
            
            const temperatureInput = document.getElementById('temperatureInput');
            temperatureInput.addEventListener('input', onTemperatureChange);

            const thinkingTokensInput = document.getElementById('thinkingTokensInput');
            thinkingTokensInput.addEventListener('input', onThinkingTokensChange);
        });

        function updateSessionTokensDisplay() {
            const sessionTokensInfo = document.getElementById('sessionTokensInfo');
            sessionTokensInfo.textContent = `Session: ${sessionTokens.total.toLocaleString()} tokens (in: ${sessionTokens.input.toLocaleString()}, out: ${sessionTokens.output.toLocaleString()})`;
        }

        function resetSessionTokens() {
            sessionTokens = {
                input: 0,
                output: 0,
                total: 0
            };
            updateSessionTokensDisplay();
        }

        window.onload = function() {
            const savedKey = localStorage.getItem(STORAGE_KEY_PREFIX + 'anthropic_api_key');
            if (savedKey) {
                API_KEY = savedKey;
                document.getElementById('apiKeyInput').value = savedKey;
                updateStatus(true);
                setupVisible = false;
            } else {
                setupVisible = true;
            }
            
            const savedSetupVisible = localStorage.getItem('setup_visible');
            if (savedSetupVisible !== null) {
                setupVisible = savedSetupVisible === 'true';
            }
            
            updateSetupToggle();
            setInitialGreeting();
            
            const savedThinkingMode = localStorage.getItem('thinking_mode');
            if (savedThinkingMode === 'true') {
                thinkingMode = true;
                updateThinkingToggle();
            }

            const savedDarkMode = localStorage.getItem('dark_mode');
            if (savedDarkMode === 'true') {
                darkMode = true;
                updateDarkModeToggle();
                applyDarkMode();
            }

            const savedMobileMode = localStorage.getItem('mobile_mode');
            if (savedMobileMode === 'true') {
                mobileMode = true;
                updateMobileModeToggle();
                applyMobileMode();
            }

            const savedTemp = localStorage.getItem('temperature');
            if (savedTemp) {
                savedTemperature = parseFloat(savedTemp);
                currentTemperature = savedTemperature;
                document.getElementById('temperatureInput').value = savedTemperature.toString();
            }

            const savedThinkingTokens = localStorage.getItem('thinking_tokens');
            if (savedThinkingTokens) {
                currentThinkingTokens = parseInt(savedThinkingTokens);
                document.getElementById('thinkingTokensInput').value = currentThinkingTokens;
            }
            
            updateTemperatureField();
            updateThinkingTokensField();
            updateThinkingIndicatorText();
            
            updateMaxTokensInfo();
            updateSessionTokensDisplay();
            
            document.getElementById('messageInput').focus();
        };

        function toggleThinking() {
            thinkingMode = !thinkingMode;
            localStorage.setItem('thinking_mode', thinkingMode.toString());
            updateThinkingToggle();
            updateMaxTokensInfo();
            updateTemperatureField();
            updateThinkingTokensField();
        }

        function updateThinkingToggle() {
            const toggle = document.getElementById('thinkingToggle');
            const indicator = document.getElementById('thinkingIndicator');
            
            if (thinkingMode) {
                toggle.classList.add('active');
                indicator.classList.add('active');
            } else {
                toggle.classList.remove('active');
                indicator.classList.remove('active');
            }
        }

		function updateMaxTokensInfo() {
			const selectedModel = document.getElementById('modelSelect').value;
			const contextWindow = MODEL_CONTEXT_WINDOWS[selectedModel];
			const maxOutputTokens = MODEL_MAX_TOKENS[selectedModel];
			
			let infoText;
			if (thinkingMode) {
				const availableOutputTokens = maxOutputTokens - currentThinkingTokens;
				infoText = `Max context/output tokens: (${contextWindow.toLocaleString()}, ${availableOutputTokens.toLocaleString()} [${currentThinkingTokens.toLocaleString()} for thinking])`;
			} else {
				infoText = `Max context/output tokens: (${contextWindow.toLocaleString()}, ${maxOutputTokens.toLocaleString()})`;
			}
			
			document.getElementById('maxTokensInfo').textContent = infoText;
		}

        function getMaxTokensForModel(modelName) {
            const baseMaxTokens = MODEL_MAX_TOKENS[modelName] || 4096;
            return thinkingMode ? baseMaxTokens - currentThinkingTokens : baseMaxTokens;
        }

        function updateStatus(connected) {
            const indicator = document.getElementById('statusIndicator');
            if (connected) {
                indicator.className = 'status-indicator connected';
            } else {
                indicator.className = 'status-indicator disconnected';
            }
        }

        function updateDebugInfo(info) {
            const debugDiv = document.getElementById('debugInfo');
            debugDiv.textContent = info;
        }

        function saveApiKey() {
			const apiKeyInput = document.getElementById('apiKeyInput');
			API_KEY = apiKeyInput.value.trim();
			
			if (API_KEY) {
				localStorage.setItem(STORAGE_KEY_PREFIX + 'anthropic_api_key', API_KEY);
                alert('API key saved successfully!');
                updateStatus(true);
                setInitialGreeting();
                testConnection();
            } else {
                alert('Please enter a valid API key');
                updateStatus(false);
            }
        }

        async function testConnection() {
            if (!API_KEY) {
                alert('Please enter and save your API key first');
                return;
            }

            updateDebugInfo('Testing connection...');

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'x-api-key': API_KEY,
                        'anthropic-version': '2023-06-01',
                        'anthropic-dangerous-direct-browser-access': 'true'
                    },
                    body: JSON.stringify({
                        model: 'claude-sonnet-4-5-20250929',
                        max_tokens: 10,
                        messages: [{role: 'user', content: 'test'}]
                    })
                });

                if (response.ok) {
                    updateDebugInfo('Connection successful! API key is valid.');
                    updateStatus(true);
                } else {
                    const errorData = await response.json();
                    updateDebugInfo(`Connection failed: ${errorData.error?.message || response.status}`);
                    updateStatus(false);
                }
            } catch (error) {
                updateDebugInfo(`Network error: ${error.message}. Note: Direct browser access to Anthropic API may be blocked by CORS.`);
                updateStatus(false);
                
                if (error.message.includes('NetworkError') || error.message.includes('Failed to fetch')) {
                    alert(`CORS Issue Detected!\n\nDirect browser access to Anthropic's API is blocked by CORS policy.\n\nSolutions:\n1. Use a backend proxy server\n2. Run Chrome with disabled security (development only):\n   --disable-web-security --user-data-dir=/tmp/chrome\n3. Use a CORS proxy service\n4. Create a local Node.js server to handle API calls`);
                }
            }
        }

        function handleKeyDown(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        function clearChat() {
            conversationHistory = [];
            resetSessionTokens();
            setInitialGreeting();
			updateDebugInfo("");
        }

        async function sendMessage() {
            if (!API_KEY) {
                alert('Please enter and save your API key first');
                return;
            }

            const messageInput = document.getElementById('messageInput');
            const message = messageInput.value.trim();
            
            if (!message) return;

            currentUserMessage = message;

            await addMessageToChat('user', message);
            
            conversationHistory.push({
                role: 'user',
                content: message
            });

            messageInput.value = '';
            const minHeight = mobileMode ? 48 : 44;
            messageInput.style.height = minHeight + 'px';
            
            const sendButton = document.getElementById('sendButton');
            sendButton.disabled = true;
            toggleCancelButton(true);
            
            currentLoadingId = showLoading();

            currentAbortController = new AbortController();

            try {
                const selectedModel = document.getElementById('modelSelect').value;
                const maxTokens = getMaxTokensForModel(selectedModel);
                
                const modeInfo = thinkingMode ? ` (thinking mode ON with ${currentThinkingTokens.toLocaleString()} thinking tokens)` : '';
                updateDebugInfo(`Sending request to model: ${selectedModel} with max_tokens: ${maxTokens}, temperature: ${currentTemperature}${modeInfo}`);
                
                const requestBody = {
                    model: selectedModel,
                    max_tokens: maxTokens,
                    messages: conversationHistory,
                    temperature: currentTemperature,
                    system: "You are a helpful AI assistant."
                };

                if (thinkingMode) {
                    requestBody.thinking = {
                        type: "enabled",
                        budget_tokens: currentThinkingTokens
                    };
                }

                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'x-api-key': API_KEY,
                        'anthropic-version': '2023-06-01',
                        'anthropic-dangerous-direct-browser-access': 'true'
                    },
                    body: JSON.stringify(requestBody),
                    signal: currentAbortController.signal
                });

                removeLoading(currentLoadingId);
                currentLoadingId = null;

                if (!response.ok) {
                    let errorMessage;
                    try {
                        const errorData = await response.json();
                        errorMessage = errorData.error?.message || `API Error: ${response.status}`;
                    } catch {
                        errorMessage = `HTTP Error: ${response.status} ${response.statusText}`;
                    }
                    throw new Error(errorMessage);
                }

                const data = await response.json();
                
                let assistantMessage = '';
                let thinkingContent = '';
                
                if (data.content && Array.isArray(data.content)) {
                    for (const block of data.content) {
                        if (block.type === 'thinking') {
                            thinkingContent = block.thinking || '';
                        } else if (block.type === 'text') {
                            assistantMessage += block.text;
                        }
                    }
                }
                
                if (data.usage) {
                    sessionTokens.input += data.usage.input_tokens || 0;
                    sessionTokens.output += data.usage.output_tokens || 0;
                    sessionTokens.total = sessionTokens.input + sessionTokens.output;
                    updateSessionTokensDisplay();
                }
                
                await addMessageToChat('assistant', assistantMessage, thinkingContent);
                
                conversationHistory.push({
                    role: 'assistant',
                    content: assistantMessage
                });

                updateDeleteButtons();
				addScrollToTopButtons();
                updateDebugInfo('Message sent successfully');

            } catch (error) {
                if (error.name === 'AbortError') {
                    updateDebugInfo('Request cancelled by user');
                } else {
                    removeLoading(currentLoadingId);
                    currentLoadingId = null;
                    showError(error.message);
                    updateDebugInfo(`Error: ${error.message}`);
                    console.error('Error:', error);
                    
                    if (error.message.includes('NetworkError') || error.message.includes('Failed to fetch')) {
                        showError('CORS blocking detected. See console for solutions.');
                    }
                }
            } finally {
                currentAbortController = null;
                currentUserMessage = '';
                currentLoadingId = null;
                
                sendButton.disabled = false;
                toggleCancelButton(false);
                messageInput.focus();
            }
        }

        function processThinkingContent(content) {
            const thinkingRegex = /<thinking>([\s\S]*?)<\/thinking>/g;
            let thinkingContent = '';
            let displayContent = content;
            
            const matches = [...content.matchAll(thinkingRegex)];
            if (matches.length > 0) {
                thinkingContent = matches.map(match => match[1].trim()).join('\n\n');
                displayContent = content.replace(thinkingRegex, '').trim();
            }
            
            return {
                displayContent,
                thinkingContent
            };
        }

        async function addMessageToChat(role, content, thinkingContent = null, addToHistory = true) {
            const chatContainer = document.getElementById('chatContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${role}`;
            
            const avatar = role === 'user' ? 'U' : 'C';
            
            const avatarDiv = document.createElement('div');
            avatarDiv.className = 'message-avatar';
            avatarDiv.textContent = avatar;
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            
            if (role === 'assistant') {
                try {
                    if (thinkingContent && thinkingMode) {
                        const thinkingDiv = document.createElement('details');
                        thinkingDiv.className = 'thinking-content';
                        thinkingDiv.innerHTML = `
                            <summary>💭 View thinking process</summary>
                            <div>${escapeHtml(thinkingContent)}</div>
                        `;
                        contentDiv.appendChild(thinkingDiv);
                    }
                    
                    const renderedContent = renderMarkdownWithCodeBlocks(content);
                    const mainContentDiv = document.createElement('div');
                    mainContentDiv.innerHTML = renderedContent;
                    contentDiv.appendChild(mainContentDiv);
                    
					await new Promise(resolve => {
						setTimeout(() => {
							addCopyButtonsToCodeBlocks(contentDiv);
							resolve();
						}, 150);
					});

                } catch (e) {
                    console.error('Error rendering markdown:', e);
                    contentDiv.textContent = content;
                }
            } else {
                contentDiv.textContent = content;
            }
            
            messageDiv.appendChild(avatarDiv);
            messageDiv.appendChild(contentDiv);
            
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

		function renderMarkdownWithCodeBlocks(content) {
			const codeBlocks = [];
			let processedContent = '';
			let inCodeBlock = false;
			let codeBlockStart = -1;
			let currentLang = '';
			
			const lines = content.split('\n');
			let i = 0;
			
			while (i < lines.length) {
				const line = lines[i];
				
				if (line.trim().startsWith('```')) {
					if (!inCodeBlock) {
						inCodeBlock = true;
						codeBlockStart = i;
						currentLang = line.trim().substring(3).trim();
						i++;
					} else {
						inCodeBlock = false;
						
						const codeLines = lines.slice(codeBlockStart + 1, i);
						const code = codeLines.join('\n');
						
						const index = codeBlocks.length;
						codeBlocks.push({ 
							lang: currentLang || 'plaintext', 
							code: code 
						});
						
						processedContent += `%%%CODEBLOCK${index}%%%\n`;
						currentLang = '';
						i++;
					}
				} else {
					if (!inCodeBlock) {
						processedContent += line + '\n';
					}
					i++;
				}
			}
			
			if (inCodeBlock) {
				const codeLines = lines.slice(codeBlockStart + 1);
				const code = codeLines.join('\n');
				const index = codeBlocks.length;
				codeBlocks.push({ 
					lang: currentLang || 'plaintext', 
					code: code 
				});
				processedContent += `%%%CODEBLOCK${index}%%%\n`;
			}
			
			let html = marked.parse(processedContent);
			
			html = html.replace(/%%%CODEBLOCK(\d+)%%%/g, (match, index) => {
				const block = codeBlocks[parseInt(index)];
				return createCodeBlock(block.code, block.lang);
			});
			
			return html;
		}

		function createCodeBlock(code, language) {
			const languageMap = {
				'py': 'python',
				'js': 'javascript',
				'ts': 'typescript',
				'sh': 'bash',
				'yml': 'yaml',
				'html': 'markup',
				'xml': 'markup',
				'pas': 'pascal',
				'dpr': 'pascal',
				'freepascal': 'pascal',
				'objectpascal': 'pascal',
				'lazarus': 'pascal'
			};
			
			const mappedLang = languageMap[language] || language;
			let highlightedCode;
			
			const codeToHighlight = code;
			
			try {
				if (Prism.languages[mappedLang]) {
					highlightedCode = Prism.highlight(codeToHighlight, Prism.languages[mappedLang], mappedLang);
				} else {
					highlightedCode = escapeHtml(codeToHighlight);
				}
			} catch (e) {
				console.warn(`Error highlighting ${mappedLang}:`, e);
				highlightedCode = escapeHtml(codeToHighlight);
			}
			
			return `<div class="code-block-wrapper" data-language="${escapeHtml(mappedLang)}">
						<pre><code class="language-${escapeHtml(mappedLang)}">${highlightedCode}</code></pre>
					</div>`;
		}

        function addCopyButtonsToCodeBlocks(container) {
            const codeBlocks = container.querySelectorAll('.code-block-wrapper');
            
            codeBlocks.forEach(block => {
                if (block.querySelector('.copy-button')) return;
                
                const language = block.getAttribute('data-language') || '';
                const isRunnable = isRunnableLanguage(language);
                
                // Add Copy button
                const copyButton = document.createElement('button');
                copyButton.className = 'copy-button';
                copyButton.textContent = 'Copy';
                
                copyButton.onclick = function() {
                    const code = block.querySelector('code').textContent;
                    navigator.clipboard.writeText(code).then(() => {
                        copyButton.textContent = 'Copied!';
                        copyButton.classList.add('copied');
                        
                        setTimeout(() => {
                            copyButton.textContent = 'Copy';
                            copyButton.classList.remove('copied');
                        }, 2000);
                    }).catch(err => {
                        console.error('Failed to copy:', err);
                        alert('Failed to copy to clipboard');
                    });
                };
                
                block.appendChild(copyButton);
                
                // Add Run button for HTML/JavaScript
                if (isRunnable) {
                    const runButton = document.createElement('button');
                    runButton.className = 'run-button';
                    runButton.textContent = 'Run';
                    
                    runButton.onclick = function() {
                        const code = block.querySelector('code').textContent;
                        runCode(code, language);
                    };
                    
                    block.appendChild(runButton);
                }
            });
        }

        function isRunnableLanguage(language) {
            const runnableLanguages = ['html', 'markup', 'javascript', 'js'];
            return runnableLanguages.includes(language.toLowerCase());
        }

        function runCode(code, language) {
            // Create a new window/tab to run the code
            const newWindow = window.open('', '_blank');
            
            if (!newWindow) {
                alert('Please allow pop-ups to run the code');
                return;
            }
            
            // If it's pure JavaScript, wrap it in HTML
            if (language === 'javascript' || language === 'js') {
                code = `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JavaScript Output</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        #output {
            background: white;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h2>JavaScript Output</h2>
    <div id="output"></div>
    <script>
        // Override console.log to display in the page
        (function() {
            const outputDiv = document.getElementById('output');
            const oldLog = console.log;
            console.log = function(...args) {
                oldLog.apply(console, args);
                const message = args.map(arg => 
                    typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
                ).join(' ');
                outputDiv.innerHTML += '<div>' + message + '</div>';
            };
        })();
        
        // User code
        try {
            ${code}
        } catch (error) {
            document.getElementById('output').innerHTML += '<div style="color: red;">Error: ' + error.message + '</div>';
        }
    <\/script>
</body>
</html>`;
            }
            
            // Write the code to the new window
            newWindow.document.open();
            newWindow.document.write(code);
            newWindow.document.close();
        }

        function showLoading() {
            const chatContainer = document.getElementById('chatContainer');
            const loadingDiv = document.createElement('div');
            const loadingId = 'loading-' + Date.now();
            loadingDiv.id = loadingId;
            loadingDiv.className = 'message assistant';
            loadingDiv.innerHTML = `
                <div class="message-avatar">C</div>
                <div class="message-content loading">
                    <div class="loading-dot"></div>
                    <div class="loading-dot"></div>
                    <div class="loading-dot"></div>
                </div>
            `;
            chatContainer.appendChild(loadingDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
            return loadingId;
        }

        function removeLoading(loadingId) {
            const loadingDiv = document.getElementById(loadingId);
            if (loadingDiv) {
                loadingDiv.remove();
            }
        }

        function showError(message) {
            const chatContainer = document.getElementById('chatContainer');
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-message';
            errorDiv.innerHTML = '<strong>Error:</strong> ' + escapeHtml(message);
            chatContainer.appendChild(errorDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        console.log(`
=== IMPORTANT: CORS Information ===

The Anthropic API blocks direct browser requests due to CORS policy.
Here are your options:

1. LOCAL PROXY SERVER (Recommended)
   Create a simple Node.js proxy server:
   
   Save this as 'proxy-server.js':
   ----------------------------------------
   const express = require('express');
   const cors = require('cors');
   const fetch = require('node-fetch');
   
   const app = express();
   app.use(cors());
   app.use(express.json());
   
   app.post('/api/messages', async (req, res) => {
     try {
       const response = await fetch('https://api.anthropic.com/v1/messages', {
         method: 'POST',
         headers: {
           'Content-Type': 'application/json',
           'x-api-key': req.headers['x-api-key'],
           'anthropic-version': '2023-06-01'
         },
         body: JSON.stringify(req.body)
       });
       
       const data = await response.json();
       res.json(data);
     } catch (error) {
       res.status(500).json({ error: error.message });
     }
   });
   
   app.listen(3000, () => {
     console.log('Proxy server running on http://localhost:3000');
   });
   ----------------------------------------
   
   Then run:
   npm install express cors node-fetch
   node proxy-server.js
   
   And update the API_URL in this HTML to: http://localhost:3000/api/messages

2. CHROME WITH DISABLED SECURITY (Development only):
   Mac: open -n -a /Applications/Google\\\\ Chrome.app/Contents/MacOS/Google\\\\ Chrome --args --user-data-dir="/tmp/chrome_dev_test" --disable-web-security
   Windows: chrome.exe --user-data-dir="C:/Chrome dev session" --disable-web-security
   Linux: google-chrome --user-data-dir="/tmp/chrome_dev_test" --disable-web-security

3. USE A PUBLIC CORS PROXY (Not recommended for production):
   Update API_URL to: https://cors-anywhere.herokuapp.com/https://api.anthropic.com/v1/messages
        `);
    </script>
</body>
</html>
